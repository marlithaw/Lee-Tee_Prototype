<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title id="page-title">Lee & Tee - Loading...</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=OpenDyslexic:wght@400;700&display=swap" rel="stylesheet">

  <!-- Engine Styles -->
  <link rel="stylesheet" href="styles/episode.css">
  <link rel="stylesheet" href="../shared/learning-dashboard.css">
  <link rel="stylesheet" href="../shared/progressive-nav.css">
</head>
<body data-episode="">
  <!-- STICKY UI: Progress Bar + Navigation + Header -->
  <div id="sticky-ui">
    <div id="section-progress-bar" class="section-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
      <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
    </div>
    <nav id="section-nav" class="section-nav" aria-label="Section navigation">
      <!-- Populated by ProgressiveNav -->
    </nav>
    <div id="global-header"></div>
  </div>

  <div id="top" class="anchor-target" aria-hidden="true"></div>

  <!-- Mobile Rail Toggle -->
  <button onclick="toggleLeftRail()"
          class="lg:hidden fixed bottom-6 left-6 z-40 w-14 h-14 bg-purple-600 text-white rounded-full shadow-lg flex items-center justify-center">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>

  <!-- LEFT RAIL SIDEBAR -->
  <aside id="left-rail" class="left-rail mobile-hidden">
    <div id="learningShell" class="learning-shell" style="position: static; border: none; box-shadow: none; padding: 1rem 0; margin-bottom: 1.5rem;">
      <button id="learningShellToggle" class="learning-shell__mobile-toggle" aria-expanded="false">
        ğŸ“š Learning Dashboard
      </button>
      <div class="learning-shell__row" style="grid-template-columns: 1fr; gap: 1rem;">
        <div class="learning-shell__section">
          <span class="learning-shell__pill">Book 1 Journey</span>
          <div class="learning-shell__meta-title">Same Structure. Different Stuff.</div>
          <div class="learning-shell__meta-subtitle">Stay aware of goals and wins across episodes.</div>
          <div class="learning-shell__label-row">
            <span id="learningShellBookLabel">Book 1: 0/4 Episodes</span>
            <span id="learningShellBookPercent">0%</span>
          </div>
          <div class="learning-shell__progress" aria-hidden="true">
            <div id="learningShellBookFill" class="learning-shell__progress-fill"></div>
          </div>
        </div>

        <div class="learning-shell__section learning-shell__episode">
          <div class="learning-shell__label-row">
            <span class="learning-shell__meta-title" id="learningShellEpisodeTitle">Episode</span>
            <span class="learning-shell__meta-subtitle" id="learningShellEpisodeLabel">0/21 sections</span>
          </div>
          <div class="learning-shell__progress" aria-hidden="true">
            <div id="learningShellEpisodeFill" class="learning-shell__progress-fill"></div>
          </div>
        </div>

        <div class="learning-shell__section">
          <div class="learning-shell__label-row">
            <span class="learning-shell__meta-title">Recent Badges</span>
            <span class="learning-shell__meta-subtitle">Motivation at a glance</span>
          </div>
          <div id="learningShellBadges" class="learning-shell__badge-row" aria-live="polite"></div>
        </div>

        <div class="learning-shell__section" style="align-items: flex-end;">
          <a id="learningShellContinue" class="learning-shell__cta" href="#">
            â–¶ Continue
          </a>
        </div>
      </div>
    </div>

    <div class="mb-6">
      <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
        <span class="text-xl">âœ“</span>
        Lesson Progress
      </h3>
      <div id="progress-checklist" class="space-y-2 text-sm"></div>
    </div>

    <div class="mb-6">
      <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
        <span class="text-xl">ğŸ”—</span>
        Quick Jump
      </h3>
      <div class="space-y-2 text-sm">
        <a href="#vocab" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">ğŸ“š Vocabulary</a>
        <a href="#story" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">ğŸ“– Story</a>
        <a href="#practice" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">âœï¸ Practice</a>
        <a href="#check" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">âœ… Check</a>
        <a href="#reflect" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">ğŸ’­ Reflect</a>
      </div>
    </div>

    <div>
      <button onclick="resetEpisodeProgress()"
              class="w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm text-gray-700 transition-colors">
        ğŸ”„ Reset Progress
      </button>
    </div>
  </aside>

  <!-- FLOATING STOP BUTTON (Mobile Read-Aloud Control) -->
  <button id="floatingStopBtn" class="floating-stop-btn" onclick="stopAllNarration()">
    <span>â¹ï¸</span>
    <span>STOP</span>
  </button>

  <!-- CELEBRATION OVERLAY -->
  <div id="celebrationOverlay" class="celebration-overlay">
    <div class="celebration-card">
      <div class="text-6xl mb-4" id="celebrationEmoji">ğŸ‰</div>
      <h3 class="font-display text-2xl font-bold mb-2" id="celebrationTitle">Great Job!</h3>
      <p class="text-gray-600 mb-4" id="celebrationMessage">You earned points!</p>
      <button onclick="closeCelebration()" class="bg-purple-600 text-white px-6 py-2 rounded-full font-bold hover:bg-purple-700">
        Continue Learning
      </button>
    </div>
  </div>

  <!-- CHARACTER HELPER BUTTONS -->
  <div id="helper-lee" class="helper-btn" onclick="openHelper('lee')">
    <img id="lee-avatar" src="" alt="Lee with notebook">
    <div class="label text-purple-600">ASK LEE</div>
  </div>

  <div id="helper-tee" class="helper-btn" onclick="openHelper('tee')">
    <img id="tee-avatar" src="" alt="Tee gesturing">
    <div class="label text-amber-600">ASK TEE</div>
  </div>

  <!-- Contextual Helper Popup -->
  <div id="contextHelper" class="fixed bottom-24 right-6 hidden z-50 animate-bounce">
    <div class="bg-white rounded-xl shadow-2xl p-4 max-w-xs border-4 border-purple-500">
      <div class="flex items-start gap-3">
        <img id="contextHelperAvatar" src="" alt="" class="w-12 h-12 rounded-full">
        <div>
          <p class="font-bold text-purple-700 mb-1" id="contextHelperName"></p>
          <p class="text-sm" id="contextHelperMessage"></p>
        </div>
      </div>
      <div class="flex gap-2 mt-3">
        <button onclick="showContextHelp()" class="flex-1 bg-purple-600 text-white px-3 py-2 rounded-lg text-sm font-bold hover:bg-purple-700">
          Show Me How
        </button>
        <button onclick="dismissContextHelper()" class="px-3 py-2 bg-gray-200 rounded-lg text-sm">
          Not Now
        </button>
      </div>
    </div>
  </div>

  <!-- LEE HELPER MODAL -->
  <div id="lee-modal" class="helper-modal" onclick="closeHelper(event, 'lee')">
    <div class="helper-content border-l-8 border-purple-500" onclick="event.stopPropagation()">
      <div class="flex items-center gap-3 mb-4">
        <img id="lee-modal-avatar" src="" alt="Lee" class="w-12 h-12 rounded-full object-cover object-top">
        <h3 class="font-display text-xl font-bold">Lee's Writing Tips</h3>
      </div>
      <p class="mb-4 text-gray-600">Stuck on your writing? Try these sentence starters:</p>
      <ul id="lee-tips" class="space-y-2 text-gray-700">
        <!-- Populated by config -->
      </ul>
      <p class="mt-4 text-xs text-gray-400 text-center">(Click outside to close)</p>
    </div>
  </div>

  <!-- TEE HELPER MODAL -->
  <div id="tee-modal" class="helper-modal" onclick="closeHelper(event, 'tee')">
    <div class="helper-content border-l-8 border-amber-500" onclick="event.stopPropagation()">
      <div class="flex items-center gap-3 mb-4">
        <img id="tee-modal-avatar" src="" alt="Tee" class="w-12 h-12 rounded-full object-cover object-top">
        <h3 class="font-display text-xl font-bold">Tee's Strategy Check</h3>
      </div>
      <p class="mb-4 text-gray-600">Don't just be loud. Be right. Ask yourself:</p>
      <ol id="tee-tips" class="space-y-3 text-gray-700">
        <!-- Populated by config -->
      </ol>
      <p class="mt-4 text-xs text-gray-400 text-center">(Click outside to close)</p>
    </div>
  </div>

  <!-- VOCABULARY MODAL -->
  <div id="vocabModal" class="vocab-modal" onclick="closeVocabModal(event)">
    <div class="vocab-card" onclick="event.stopPropagation()">
      <div class="flex items-start gap-4 mb-3">
        <div class="text-4xl" id="vocabImage">ğŸ“š</div>
        <div class="flex-1">
          <div class="flex justify-between items-start">
            <h3 class="font-display text-xl font-bold" id="vocabWord">Word</h3>
            <button class="audio-btn text-sm" onclick="speakWord()">ğŸ”Š Hear It</button>
          </div>
          <p class="text-lg mb-2 mt-1" id="vocabDef">Definition here</p>
          <p class="text-sm text-gray-500" id="vocabSpanish">En espaÃ±ol: palabra</p>
        </div>
      </div>
      <div class="bg-amber-50 p-3 rounded-lg">
        <p class="text-sm font-semibold text-amber-800 mb-1">ğŸ“– In the Story:</p>
        <p class="text-sm italic" id="vocabExample">"Example sentence"</p>
      </div>
    </div>
  </div>

  <!-- ACCESSIBILITY PANEL -->
  <div class="a11y-panel">
    <div class="a11y-menu" id="a11yMenu">
      <p class="font-semibold mb-3">Reading Settings</p>
      <div class="a11y-toggle">
        <span>ğŸ”Š Read Aloud</span>
        <div class="toggle" id="toggleAudio" onclick="toggleSetting('audio')"></div>
      </div>
      <div class="a11y-toggle">
        <span>ğŸ“– Dyslexia Font</span>
        <div class="toggle" id="toggleDyslexia" onclick="toggleSetting('dyslexia')"></div>
      </div>
      <div class="a11y-toggle">
        <span>ğŸŒ™ High Contrast</span>
        <div class="toggle" id="toggleContrast" onclick="toggleSetting('contrast')"></div>
      </div>
      <div class="a11y-toggle">
        <span>ğŸ“ Show Hints</span>
        <div class="toggle on" id="toggleHints" onclick="toggleSetting('hints')"></div>
      </div>
      <div class="a11y-toggle">
        <span>ğŸ« SIOP Strategies</span>
        <div class="toggle" id="toggleSiop" onclick="toggleSiopStrategies()"></div>
      </div>
      <div class="a11y-toggle">
        <span>ğŸ”„ Reset Progress</span>
        <button class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded" onclick="resetProgress()">Reset</button>
      </div>
    </div>
    <button class="a11y-btn" onclick="toggleA11yMenu()" aria-label="Accessibility settings">
      âš™ï¸
    </button>
  </div>

  <!-- SIOP STRATEGIES MODAL -->
  <div id="siopModal" class="helper-modal" onclick="closeSiopModal(event)">
    <div class="helper-content border-l-8 border-teal-500" onclick="event.stopPropagation()">
      <div class="flex items-center gap-3 mb-4">
        <div class="text-3xl text-teal-600">ğŸ«</div>
        <h3 class="font-display text-xl font-bold">SIOP Strategies Used</h3>
      </div>
      <div class="space-y-3">
        <div class="siop-strategy"><span>ğŸ“š</span><span>Vocabulary Pre-teaching</span></div>
        <div class="siop-strategy"><span>ğŸ—£ï¸</span><span>Sentence Frames</span></div>
        <div class="siop-strategy"><span>ğŸ‘¥</span><span>Cooperative Learning</span></div>
        <div class="siop-strategy"><span>ğŸ–¼ï¸</span><span>Visual Supports</span></div>
        <div class="siop-strategy"><span>ğŸ”Š</span><span>Oral Language Practice</span></div>
        <div class="siop-strategy"><span>ğŸ“</span><span>Scaffolded Writing</span></div>
      </div>
      <p class="mt-4 text-xs text-gray-400 text-center">SIOP = Sheltered Instruction Observation Protocol</p>
    </div>
  </div>

  <!-- MAIN CONTENT AREA -->
  <main class="main-with-rail max-w-4xl mx-auto min-h-screen pb-20">
    <div class="px-4 sm:px-6 lg:px-8">
      <!-- SIOP Objectives Banner -->
      <div id="siop-banner" class="bg-gradient-to-r from-teal-50 to-blue-50 p-4 border-b border-teal-200">
        <!-- Populated by engine -->
      </div>

      <!-- Hero Section -->
      <header id="hero-section" class="relative">
        <!-- Populated by engine -->
      </header>

      <!-- Learning Objectives -->
      <section id="learning-objectives" class="bg-white border-b p-6">
        <!-- Populated by engine -->
      </section>
    </div>

    <!-- Section Display Container (for ProgressiveNav) -->
    <div id="section-display" class="section-display">
      <!-- Sections rendered here by engine -->
    </div>
  </main>

  <!-- Badge Container (for earned badges) -->
  <div id="badgeContainer" class="fixed bottom-4 right-20 flex gap-2 z-50"></div>

  <!-- Points Display -->
  <div id="pointsDisplay" class="hidden">0</div>
  <div id="finalPoints" class="hidden">0</div>

  <!-- EXTERNAL SCRIPTS (in correct order) -->
  <script src="../shared-header.js"></script>
  <script src="../shared-skills.js"></script>
  <script src="../shared/shared/learning-dashboard.js"></script>
  <script src="../translations/translation-engine.js"></script>
  <script src="../shared/progressive-nav.js"></script>
  <script src="../shared/adaptive-helpers.js"></script>

  <!-- ENGINE MODULES -->
  <script src="modules/state.js"></script>
  <script src="modules/gamification.js"></script>
  <script src="modules/vocabulary.js"></script>
  <script src="modules/narration.js"></script>
  <script src="modules/activities.js"></script>
  <script src="modules/accessibility.js"></script>

  <!-- ENGINE CORE (loads config and renders) -->
  <script src="core.js"></script>
</body>
</html>
