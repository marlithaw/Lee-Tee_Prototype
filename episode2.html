<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Episode 2: Grandpa's Kitchen | Lee & Tee Book 1</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- OpenDyslexic Font (for accessibility) -->
  <link href="https://fonts.cdnfonts.com/css/opendyslexic" rel="stylesheet">

  <!-- Shared Design System -->
  <link rel="stylesheet" href="shared-styles.css">
  <link rel="stylesheet" href="episode2.css">
  <link rel="stylesheet" href="shared/progressive-nav.css">
  <link rel="stylesheet" href="shared/learning-dashboard.css">

  <style>
    /* Episode 2 Specific Styles */
    body {
      font-family: 'Lexend', sans-serif;
      background: linear-gradient(to bottom, #FFF8F0 0%, #FEF3E2 100%);
      min-height: 100vh;
      margin: 0;
      padding: 0;
      color: #1C1917;
    }

    /* Episode 2 Amber Theme */
    :root {
      --episode-color: #F59E0B;
      --episode-light: #FEF3C7;
      --episode-dark: #D97706;
    }

    .episode-accent {
      color: var(--episode-color);
    }

    .episode-bg {
      background-color: var(--episode-light);
    }

    /* Header with gradient */
    .hero-header {
      background: linear-gradient(135deg, #FEF3C7 0%, #FBBF24 50%, #F59E0B 100%);
      padding: 3rem 1.5rem;
      text-align: center;
      color: #78350F;
      margin-bottom: 2rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    /* Progress Bar */
    .progress-container {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 8px;
      background: rgba(255, 255, 255, 0.3);
      z-index: 1000;
      backdrop-filter: blur(10px);
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(to right, #F59E0B, #FBBF24);
      width: 0%;
      transition: width 0.5s ease;
    }

    /* Math Interactive Containers */
    .math-tool {
      background: white;
      border: 3px solid var(--episode-color);
      border-radius: 1rem;
      padding: 2rem;
      margin: 2rem 0;
      box-shadow: 0 4px 12px rgba(245, 158, 11, 0.2);
    }

    .fraction-display {
      font-size: 2.5rem;
      font-weight: bold;
      text-align: center;
      margin: 1rem 0;
      color: var(--episode-dark);
    }

    .fraction-bar {
      border-top: 4px solid var(--episode-color);
      margin: 0.5rem auto;
      width: 80px;
    }

    /* Recipe Card Styling */
    .recipe-card {
      background: #FFFBF0;
      border: 2px solid var(--episode-color);
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-radius: 0.75rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-family: 'Courier New', monospace;
    }

    .ingredient-line {
      padding: 0.75rem;
      border-bottom: 1px dashed #FEF3C7;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ingredient-line:last-child {
      border-bottom: none;
    }

    .ingredient-amount {
      font-weight: bold;
      color: var(--episode-dark);
    }

    /* Calculation Display */
    .calc-step {
      background: #FEF3C7;
      border-left: 4px solid var(--episode-color);
      padding: 1rem 1.5rem;
      margin: 1rem 0;
      border-radius: 0.5rem;
      font-family: 'Courier New', monospace;
      font-size: 1.1rem;
    }

    /* Math Answer Choices */
    .math-choice {
      background: white;
      border: 3px solid #FEF3C7;
      padding: 1rem 1.5rem;
      margin: 0.75rem 0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .math-choice:hover {
      border-color: #F59E0B;
      background: #FEF3C7;
      transform: translateX(4px);
    }

    .math-choice.correct {
      border-color: #16A34A;
      background: #DCFCE7;
    }

    .math-choice.incorrect {
      border-color: #DC2626;
      background: #FEE2E2;
    }

    /* Floating Stop Button */
    .floating-stop-btn {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 200;
      background: #DC2626;
      color: white;
      padding: 14px 20px;
      border-radius: 50px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);
      cursor: pointer;
      display: none;
      align-items: center;
      gap: 8px;
      animation: pulse 2s infinite;
    }

    .floating-stop-btn.active {
      display: flex;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Character Helper Buttons (matches Episode 1) */
    .helper-btn {
      position: fixed;
      bottom: 20px;
      z-index: 90;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .helper-btn:hover { transform: scale(1.1); }
    .helper-btn img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      object-fit: cover;
      object-position: top center;
    }
    .helper-btn .label {
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.65rem;
      font-weight: 700;
      white-space: nowrap;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    #helper-lee { left: 20px; }
    #helper-tee { left: 100px; }

    /* Helper Modals */
    .helper-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 150;
      padding: 1rem;
    }
    .helper-modal.open { display: flex; }
    .helper-content {
      background: white;
      border-radius: 1rem;
      padding: 1.5rem;
      max-width: 380px;
      width: 100%;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }

    /* Story Text Highlighting */
    .story-text {
      font-size: 1.25rem;
      line-height: 2;
      margin: 1.5rem 0;
      color: #292524;
    }

    .story-text p {
      margin-bottom: 1.5rem;
    }

    .active-word {
      background: linear-gradient(120deg, #FBBF24 0%, #FEF3C7 100%);
      padding: 2px 4px;
      border-radius: 4px;
      font-weight: 600;
    }

    .active-sentence {
      border-left: 5px solid #F59E0B;
      padding-left: 1rem;
      background: rgba(254, 243, 199, 0.3);
    }

    /* Sticky Navigation */
    .sticky-section-nav {
      position: sticky;
      top: 50px;
      background: white;
      padding: 1rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 50;
      margin-bottom: 2rem;
      border-radius: 12px;
    }

    /* Conversion Table */
    .conversion-table {
      background: white;
      border: 2px solid var(--episode-color);
      border-radius: 0.75rem;
      overflow: hidden;
      margin: 1.5rem 0;
    }

    .conversion-row {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 1rem;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #FEF3C7;
      align-items: center;
    }

    .conversion-row:last-child {
      border-bottom: none;
    }

    .conversion-row:nth-child(even) {
      background: #FFFBF0;
    }

    /* Mobile Responsiveness */
    @media (max-width: 768px) {
      html, body {
        overflow-x: hidden !important;
        width: 100% !important;
        max-width: 100vw !important;
      }

      .hero-header {
        padding: 2rem 1rem;
      }

      .story-text {
        font-size: 1.1rem;
      }

      .fraction-display {
        font-size: 2rem;
      }

      .math-tool {
        padding: 1rem;
      }

      .conversion-row {
        grid-template-columns: 1fr;
        text-align: center;
      }
    }

    /* Dyslexia Mode */
    body.dyslexia-mode {
      font-family: 'OpenDyslexic', sans-serif;
      letter-spacing: 0.05em;
      word-spacing: 0.1em;
      line-height: 2;
    }

    /* High Contrast Mode */
    body.high-contrast {
      background: #000000;
      color: #FFFFFF;
    }

    body.high-contrast .math-tool,
    body.high-contrast .recipe-card {
      background: #1a1a1a;
      border-color: #FFFFFF;
      color: #FFFFFF;
    }

    body.high-contrast .math-choice {
      background: #1a1a1a;
      border-color: #FFFFFF;
      color: #FFFFFF;
    }

    /* Left Rail Sidebar */
    .left-rail {
      position: fixed;
      left: 0;
      top: 80px;
      width: 280px;
      height: calc(100vh - 80px);
      background: white;
      border-right: 2px solid var(--border-light);
      overflow-y: auto;
      padding: 1.5rem;
      z-index: 30;
      transition: transform 0.3s ease;
    }

    .left-rail.mobile-hidden {
      transform: translateX(-100%);
    }

    .main-with-rail {
      margin-left: 280px;
      padding-top: 80px;
    }

    @media (max-width: 1024px) {
      .left-rail {
        transform: translateX(-100%);
      }

      .left-rail.mobile-open {
        transform: translateX(0);
      }

      .main-with-rail {
        margin-left: 0;
      }
    }

    .help-box {
      border-left: 4px solid currentColor;
      transition: all 0.3s ease;
    }
  </style>

  <!-- Load Shared Components -->
  <script src="shared-header.js"></script>
  <script src="shared-skills.js"></script>
  <script src="shared/shared/learning-dashboard.js"></script>

  <!-- Load Progressive Navigation & Translation System -->
  <script src="translations/translation-engine.js"></script>
  <script src="shared/progressive-nav.js"></script>
  <script src="shared/adaptive-helpers.js"></script>
</head>
<body data-episode="2">
  <div id="sticky-ui">
    <!-- Progressive Navigation: Progress Bar + Section Nav -->
    <div id="section-progress-bar" class="section-progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
      <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
    </div>

    <nav id="section-nav" class="section-nav" aria-label="Section navigation">
      <!-- Will be populated by JavaScript -->
    </nav>

    <!-- Global Header -->
    <div id="global-header"></div>
  </div>

  <!-- Mobile Rail Toggle -->
  <button onclick="toggleLeftRail()"
          class="lg:hidden fixed bottom-6 left-6 z-40 w-14 h-14 bg-amber-600 text-white rounded-full shadow-lg flex items-center justify-center">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>

  <!-- Left Rail Sidebar -->
  <aside id="left-rail" class="left-rail mobile-hidden">
    <!-- Unified Learning Dashboard Shell (matches Episode 1) -->
    <div id="learningShell" class="learning-shell" style="position: static; border: none; box-shadow: none; padding: 1rem 0; margin-bottom: 1.5rem;">
      <button id="learningShellToggle" class="learning-shell__mobile-toggle" aria-expanded="false">
        üìö Learning Dashboard
      </button>
      <div class="learning-shell__row" style="grid-template-columns: 1fr; gap: 1rem;">
        <div class="learning-shell__section">
          <span class="learning-shell__pill">Book 1 Journey</span>
          <div class="learning-shell__meta-title">Same Structure. Different Stuff.</div>
          <div class="learning-shell__meta-subtitle">Stay aware of goals and wins across episodes.</div>
          <div class="learning-shell__label-row">
            <span id="learningShellBookLabel">Book 1: 0/4 Episodes</span>
            <span id="learningShellBookPercent">0%</span>
          </div>
          <div class="learning-shell__progress" aria-hidden="true">
            <div id="learningShellBookFill" class="learning-shell__progress-fill"></div>
          </div>
        </div>

        <div class="learning-shell__section learning-shell__episode">
          <div class="learning-shell__label-row">
            <span class="learning-shell__meta-title" id="learningShellEpisodeTitle">Episode 2</span>
            <span class="learning-shell__meta-subtitle" id="learningShellEpisodeLabel">0/15 sections</span>
          </div>
          <div class="learning-shell__progress" aria-hidden="true">
            <div id="learningShellEpisodeFill" class="learning-shell__progress-fill"></div>
          </div>
        </div>

        <div class="learning-shell__section">
          <div class="learning-shell__label-row">
            <span class="learning-shell__meta-title">Recent Badges</span>
            <span class="learning-shell__meta-subtitle">Motivation at a glance</span>
          </div>
          <div id="learningShellBadges" class="learning-shell__badge-row" aria-live="polite"></div>
        </div>

        <div class="learning-shell__section" style="align-items: flex-end;">
          <a id="learningShellContinue" class="learning-shell__cta" href="#">
            ‚ñ∂ Continue
          </a>
        </div>
      </div>
    </div>

    <div class="mb-6">
      <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
        <span class="text-xl">‚úì</span>
        Lesson Progress
      </h3>
      <div id="progress-checklist" class="space-y-2 text-sm"></div>
    </div>

    <div class="mb-6">
      <h3 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
        <span class="text-xl">üîó</span>
        Quick Jump
      </h3>
      <div class="space-y-2 text-sm">
        <a href="#section-1" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">üëÉ The Smell</a>
        <a href="#section-3" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">ü•© Beef Calculation</a>
        <a href="#section-5" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">‚úñÔ∏è Fractions</a>
        <a href="#section-7" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">üîÑ Conversions</a>
        <a href="#section-10" class="block px-3 py-2 rounded-lg hover:bg-gray-100 text-gray-700">‚úçÔ∏è Reflection</a>
      </div>
    </div>

    <div>
      <button onclick="resetEpisodeProgress()"
              class="w-full px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm text-gray-700 transition-colors">
        üîÑ Reset Progress
      </button>
    </div>
  </aside>

  <!-- FLOATING STOP BUTTON -->
  <button id="floatingStopBtn" class="floating-stop-btn" onclick="stopAllNarration()">
    <span>‚èπÔ∏è</span>
    <span>STOP</span>
  </button>

  <!-- Character Helper Buttons (matching Episode 1) -->
  <div id="helper-lee" class="helper-btn" onclick="openHelper('lee')">
    <img src="Gemini_Generated_Image_8qgtlc8qgtlc8qgt.png" alt="Lee with notebook">
    <div class="label text-purple-600">ASK LEE</div>
  </div>

  <div id="helper-tee" class="helper-btn" onclick="openHelper('tee')">
    <img src="Gemini_Generated_Image_bvzywpbvzywpbvzy.png" alt="Tee gesturing">
    <div class="label text-amber-600">ASK TEE</div>
  </div>

  <!-- Lee's Helper Modal -->
  <div id="lee-modal" class="helper-modal" onclick="closeHelper(event, 'lee')">
    <div class="helper-content bg-purple-50 border-2 border-purple-300">
      <div class="flex items-center gap-3 mb-4">
        <img src="Gemini_Generated_Image_8qgtlc8qgtlc8qgt.png" alt="Lee" class="w-14 h-14 rounded-full border-2 border-purple-400 object-cover object-top">
        <div>
          <h3 class="font-display text-xl font-bold text-purple-700">Lee's Writing Tips</h3>
          <p class="text-sm text-purple-600">For Episode 2: Math & Precision</p>
        </div>
      </div>
      <div class="space-y-3 text-sm">
        <div class="bg-white rounded-lg p-3 border border-purple-200">
          <p class="font-semibold text-purple-800 mb-1">üìù Sentence Starters</p>
          <ul class="list-disc pl-4 space-y-1 text-gray-700">
            <li>"The recipe requires..." ‚Üí explain quantities</li>
            <li>"To scale up/down, I need to..." ‚Üí show process</li>
            <li>"Converting units means..." ‚Üí define terms</li>
          </ul>
        </div>
        <div class="bg-white rounded-lg p-3 border border-purple-200">
          <p class="font-semibold text-purple-800 mb-1">üßÆ Math Writing Tips</p>
          <p class="text-gray-700">Show your work! Write out each step clearly.</p>
        </div>
      </div>
      <button onclick="document.getElementById('lee-modal').classList.remove('open')" class="mt-4 w-full bg-purple-600 text-white py-2 rounded-lg font-semibold">Got it!</button>
    </div>
  </div>

  <!-- Tee's Helper Modal -->
  <div id="tee-modal" class="helper-modal" onclick="closeHelper(event, 'tee')">
    <div class="helper-content bg-amber-50 border-2 border-amber-300">
      <div class="flex items-center gap-3 mb-4">
        <img src="Gemini_Generated_Image_bvzywpbvzywpbvzy.png" alt="Tee" class="w-14 h-14 rounded-full border-2 border-amber-400 object-cover object-top">
        <div>
          <h3 class="font-display text-xl font-bold text-amber-700">Tee's Strategy Check</h3>
          <p class="text-sm text-amber-600">Think about these questions...</p>
        </div>
      </div>
      <div class="space-y-3 text-sm">
        <div class="bg-white rounded-lg p-3 border border-amber-200">
          <p class="font-semibold text-amber-800 mb-1">üéØ Check Your Work</p>
          <ul class="list-disc pl-4 space-y-1 text-gray-700">
            <li>Does my answer make sense?</li>
            <li>Did I multiply/divide correctly?</li>
            <li>Are my units correct?</li>
          </ul>
        </div>
        <div class="bg-white rounded-lg p-3 border border-amber-200">
          <p class="font-semibold text-amber-800 mb-1">üîç When Stuck</p>
          <p class="text-gray-700">Go back to the original recipe and identify what changed.</p>
        </div>
      </div>
      <button onclick="document.getElementById('tee-modal').classList.remove('open')" class="mt-4 w-full bg-amber-500 text-white py-2 rounded-lg font-semibold">Got it!</button>
    </div>
  </div>

  <!-- MAIN CONTENT CONTAINER -->
  <main class="main-with-rail min-h-screen pb-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- EPISODE HEADER -->
    <header class="hero-gradient text-white p-8 md:p-12 text-center mb-8" style="background: linear-gradient(135deg, #FEF3C7 0%, #FBBF24 50%, #F59E0B 100%); color: #78350F; border-radius: 1rem;">
      <div class="inline-block bg-white/20 backdrop-blur px-4 py-1 rounded-full text-sm font-semibold mb-4">
        üìê Episode 2 ‚Ä¢ Mathematics: Ratios & Conversions
      </div>
      <h1 class="font-display text-4xl md:text-5xl font-bold mb-3">Episode 2: Grandpa's Kitchen</h1>
      <p class="text-xl opacity-90 max-w-md mx-auto">
        Korean Bulgogi & the Math of Precision
      </p>
    </header>

    <!-- SECTION DISPLAY CONTAINER -->
    <div id="section-display">
      <!-- Sections will be wrapped by JavaScript -->
    </div>

    <!-- SECTION 1: THE SMELL (SEL + OPENER) -->
    <section id="section-1" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üëÉ The Smell
        </h2>

        <!-- PLACEHOLDER: Basement Stairs Scene -->
        <div class="img-placeholder mb-6" style="height: 220px;">
          üè† SCENE IMAGE PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Lee and Tee on basement stairs, smell wafting down - soy sauce, garlic, sesame oil)</span>
        </div>

        <div class="story-text">
          <p>The smell hit them halfway down the basement stairs.</p>
          <p>Soy sauce. Sesame oil. Garlic. Something sweet underneath‚Äîmaybe brown sugar, maybe honey.</p>
          <p>Tee stopped mid-step and grinned. "Grandpa's making that Korean thing again."</p>
          <p>Lee looked up from her notebook. She had been thinking about her essay the whole walk home, but now her stomach reminded her she had skipped most of lunch.</p>
          <p>"We should help," she said.</p>
          <p>Tee was already heading back up.</p>
        </div>

        <div class="flex gap-3 mt-6">
          <button onclick="playStorySection('section-1')" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold transition flex items-center gap-2">
            <span>üéôÔ∏è</span>
            <span>Read Aloud</span>
          </button>
        </div>

        <div id="progress-section1" class="progress-check" data-points="5"></div>
      </div>
    </section>

    <!-- SECTION 2: FINDING GRANDPA -->
    <section id="section-2" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üë®‚Äçüç≥ The Recipe Card from Korea
        </h2>

        <!-- PLACEHOLDER: Grandpa at Counter -->
        <div class="img-placeholder mb-6" style="height: 240px;">
          üë®‚Äçüç≥ GRANDPA SCENE PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Grandpa at counter with stained index card, Korean ingredients spread out: soy sauce bottle with Korean writing, ginger root, green onions, sesame oil, beef in bowl)</span>
        </div>

        <div class="story-text">
          <p>They found Grandpa at the counter, sleeves rolled up to his elbows, studying a stained index card like it held coordinates to buried treasure.</p>
          <p>Behind him, ingredients crowded the cutting board: dark soy sauce in a glass bottle, rice wine with a faded label, ginger root still dusted with dirt, green onions tied in a rubber band, a bottle of sesame oil with Korean writing on the side.</p>
          <p>A package of thinly sliced beef sat in a bowl, waiting.</p>
          <p>"Smells like you're making my favorite Korean dish," Tee announced, as though the meal was only created with him in mind.</p>
          <p>Grandpa smirked but did not look up. "You know it. I served all that time in Korea just to learn to make bulgogi so I could prepare it for you, fifty years later."</p>
          <p>Tee laughed. "I appreciate the sacrifice."</p>
          <p>Lee set her notebook down on the far end of the counter, away from the ingredients. "What's bulgogi?"</p>
          <p>"Marinated beef," Grandpa said. "Sweet, savory, a little bit of heat if you do it right." He tapped the index card. "Learned this from a man named Park. Shared a tent with him outside Incheon. He taught me how to make this, I taught him how to play spades. Fair trade."</p>
        </div>

        <!-- PLACEHOLDER: Vintage Recipe Card -->
        <div class="img-placeholder mb-6 mt-6" style="height: 200px;">
          üìã RECIPE CARD CLOSE-UP PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Stained index card with faded handwriting - "Park's Bulgogi - Serves 4")</span>
        </div>

        <div class="flex gap-3 mt-6">
          <button onclick="playStorySection('section-2')" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold transition flex items-center gap-2">
            <span>üéôÔ∏è</span>
            <span>Read Aloud</span>
          </button>
        </div>

        <div id="progress-section2" class="progress-check" data-points="5"></div>
      </div>
    </section>

    <!-- SECTION 3: CALCULATING THE BEEF -->
    <section id="section-3" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          ü•© Calculating the Beef
        </h2>

        <div class="story-text">
          <p>Tee leaned over to look at the card. The handwriting was small, careful, faded in some places where water or grease had blurred the ink.</p>
          <p>"How much are you making?" Tee asked.</p>
          <p>"Well," Grandpa said, setting the card down, "this recipe serves four people. But we got nine mouths to feed tonight."</p>
          <p>Lee pulled her notebook closer, flipping to a clean page. "So you need to make more than what the recipe says."</p>
          <p>"Exactly." Grandpa picked up the beef. "Recipe calls for two pounds of meat. But if two pounds feeds four people‚Ä¶"</p>
          <p>Tee did the math in his head first. "That's half a pound per person."</p>
          <p>"Right." Grandpa pointed at him. "So how much do we need for nine?"</p>
        </div>

        <div class="math-tool">
          <h3 class="font-bold text-xl mb-4 text-center">üìä Beef Calculation</h3>

          <div class="calc-step">
            <strong>Step 1:</strong> Find pounds per person<br>
            2 pounds √∑ 4 people = <span class="episode-accent">0.5 pounds per person</span>
          </div>

          <div class="calc-step">
            <strong>Step 2:</strong> Multiply by 9 people<br>
            0.5 pounds √ó 9 people = <strong>?</strong>
          </div>

          <div class="text-center my-6">
            <p class="text-gray-700 mb-4 text-lg">How many pounds of beef do they need?</p>
            <input type="number" step="0.1" id="beef-answer" placeholder="?" class="border-3 border-amber-300 rounded-lg px-4 py-2 text-2xl font-bold text-center w-32">
            <span class="text-xl ml-2">pounds</span>
            <br>
            <button onclick="checkBeefAnswer()" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold mt-4 transition">
              Check Answer
            </button>
          </div>

          <div id="beef-feedback" class="mt-4"></div>
        </div>

        <div class="story-text mt-6">
          <p>Lee was already writing it out in her notebook, the way Ms. Rodriguez had taught them to show their work.</p>
          <p class="font-mono bg-amber-50 p-4 rounded">
            2 pounds √∑ 4 people = 0.5 pounds per person<br>
            0.5 pounds √ó 9 people = 4.5 pounds
          </p>
          <p>"Four and a half pounds," Lee said.</p>
          <p>Grandpa nodded. "That's what I got. Good."</p>
          <p>He unwrapped another package of beef from the fridge and set it on the scale. The numbers blinked: 2.6 pounds.</p>
          <p>"Close enough," he said. "Little extra never hurt."</p>
        </div>

        <div id="progress-section3" class="progress-check" data-points="10"></div>
      </div>
    </section>

    <!-- SECTION 4: THE SCALE FACTOR -->
    <section id="section-4" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üî¢ Discovering the Scale Factor
        </h2>

        <div class="story-text">
          <p>"Now the marinade," Grandpa said, pulling ingredients toward him. "This is where it gets tricky."</p>
          <p>He read from the card. "Recipe says: one-third cup soy sauce, two tablespoons brown sugar, one tablespoon sesame oil, two teaspoons rice wine, one teaspoon grated ginger, two cloves garlic."</p>
          <p>Tee frowned. "But that's for four people. We're making for nine."</p>
          <p>"Right." Grandpa tapped the counter. "So we gotta scale everything up."</p>
          <p>Lee looked at her notebook. She had already written the ratio: 4 people ‚Üí 9 people.</p>
          <p>"That's‚Ä¶" She paused, thinking. "That's multiplying everything by two point two five."</p>
          <p>Tee raised an eyebrow. "How'd you get that?"</p>
          <p>"Nine divided by four," Lee said.</p>
        </div>

        <div class="math-tool">
          <h3 class="font-bold text-xl mb-4 text-center">üéØ Finding the Scale Factor</h3>

          <div class="text-center mb-6">
            <p class="text-lg text-gray-700 mb-4">The scale factor tells us how much to multiply each ingredient by.</p>

            <div class="inline-flex items-center gap-4 text-3xl font-bold mb-6">
              <div>
                <div class="episode-accent">9</div>
                <div class="fraction-bar" style="width: 60px;"></div>
                <div class="episode-accent">4</div>
              </div>
              <div>=</div>
              <div class="episode-accent">?</div>
            </div>

            <button onclick="calculateScaleFactor()" class="bg-amber-500 hover:bg-amber-600 text-white px-8 py-3 rounded-xl font-bold text-lg transition">
              Calculate 9 √∑ 4
            </button>

            <div id="scale-factor-result" class="hidden mt-6">
              <div class="bg-amber-50 border-3 border-amber-300 rounded-xl p-6">
                <div class="fraction-display">
                  <div>9</div>
                  <div class="fraction-bar"></div>
                  <div>4</div>
                </div>
                <p class="text-3xl font-bold episode-accent mt-4">
                  = 2.25
                </p>
                <p class="text-gray-700 mt-4 text-lg">
                  Every ingredient gets multiplied by <strong class="episode-accent">2.25</strong>
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="story-text mt-6">
          <p>She wrote it out:</p>
          <p class="font-mono bg-amber-50 p-4 rounded">
            9 √∑ 4 = 2.25
          </p>
          <p>"So every ingredient gets multiplied by 2.25," she said.</p>
          <p>Grandpa grinned. "Look at you. Alright, let's do it. Start with the soy sauce. One-third cup, times 2.25."</p>
        </div>

        <div id="progress-section4" class="progress-check" data-points="10"></div>
      </div>
    </section>

    <!-- SECTION 5: FRACTION √ó DECIMAL -->
    <section id="section-5" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          ‚úñÔ∏è Multiplying Fractions and Decimals
        </h2>

        <div class="story-text">
          <p>Lee wrote it down:</p>
          <p class="font-mono bg-amber-50 p-4 rounded">
            1/3 √ó 2.25 = ?
          </p>
          <p>She stared at the problem. Fractions and decimals together always took her an extra second.</p>
          <p>Tee leaned over. "Turn the decimal into a fraction. 2.25 is the same as nine-fourths."</p>
          <p>Lee blinked. "How do you know that?"</p>
          <p>"Two and a quarter. Two wholes and one-fourth. That's nine-fourths."</p>
        </div>

        <div class="math-tool">
          <h3 class="font-bold text-xl mb-4 text-center">üîÑ Converting 2.25 to a Fraction</h3>

          <div class="calc-step">
            <strong>Think about it:</strong><br>
            2.25 = 2 + 0.25<br>
            2.25 = 2 + ¬º<br>
            2.25 = 2¬º
          </div>

          <div class="calc-step">
            <strong>Convert to improper fraction:</strong><br>
            2¬º = (2 √ó 4 + 1) / 4<br>
            2¬º = (8 + 1) / 4<br>
            2¬º = <span class="episode-accent">9/4</span>
          </div>

          <div class="bg-amber-50 border-3 border-amber-300 rounded-xl p-6 mt-6 text-center">
            <p class="text-2xl font-bold episode-accent">
              2.25 = 9/4
            </p>
          </div>

          <h3 class="font-bold text-xl mb-4 text-center mt-8">‚úñÔ∏è Now Multiply the Fractions</h3>

          <div class="text-center mb-6">
            <div class="inline-flex items-center gap-4 text-3xl font-bold">
              <div>
                <div class="episode-accent">1</div>
                <div class="fraction-bar" style="width: 50px;"></div>
                <div class="episode-accent">3</div>
              </div>
              <div>√ó</div>
              <div>
                <div class="episode-accent">9</div>
                <div class="fraction-bar" style="width: 50px;"></div>
                <div class="episode-accent">4</div>
              </div>
              <div>=</div>
              <div>?</div>
            </div>
          </div>

          <div class="calc-step">
            <strong>Multiply numerators:</strong> 1 √ó 9 = 9<br>
            <strong>Multiply denominators:</strong> 3 √ó 4 = 12<br>
            <strong>Result:</strong> 9/12
          </div>

          <div class="calc-step">
            <strong>Simplify:</strong><br>
            9/12 = (9√∑3) / (12√∑3)<br>
            9/12 = <span class="episode-accent">3/4</span>
          </div>

          <div class="bg-green-50 border-3 border-green-500 rounded-xl p-6 mt-6 text-center">
            <p class="text-xl text-gray-700 mb-2">Soy Sauce Amount:</p>
            <div class="fraction-display">
              <div>3</div>
              <div class="fraction-bar"></div>
              <div>4</div>
            </div>
            <p class="text-2xl font-bold text-green-700 mt-2">
              = ¬æ cup
            </p>
          </div>
        </div>

        <div class="story-text mt-6">
          <p>He wrote it next to her work:</p>
          <p class="font-mono bg-amber-50 p-4 rounded">
            2.25 = 9/4<br>
            1/3 √ó 9/4 = 9/12<br>
            9/12 = 3/4
          </p>
          <p>"Three-fourths cup," Tee said.</p>
          <p>Grandpa was already pulling out the measuring cups. "Three-fourths it is."</p>
          <p>He poured the soy sauce carefully, tilting the bottle so it did not glug. The dark liquid filled the measuring cup almost to the line, then he topped it off with a few drops from a spoon.</p>
          <p>"Cooking is like math," Grandpa said, setting the bottle down. "You need the right proportions. Too much soy sauce and it's too salty. Not enough sugar and it don't balance. <strong class="episode-accent">Precision matters.</strong>"</p>
          <p>Lee wrote that down in the margin of her notebook: <em>Precision matters.</em></p>
          <p>It sounded like something Ms. Rodriguez would say about citing evidence.</p>
        </div>

        <div id="progress-section5" class="progress-check" data-points="15"></div>
      </div>
    </section>

    <!-- SECTION 6: SCALING THE REST -->
    <section id="section-6" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üìè Scaling the Ingredients
        </h2>

        <div class="story-text">
          <p>They worked through the rest of the marinade, one ingredient at a time.</p>
        </div>

        <div class="recipe-card">
          <h3 class="font-bold text-xl mb-4 episode-accent text-center">ü•ò Original Recipe (4 people) ‚Üí Scaled Recipe (9 people)</h3>
          <p class="text-center text-sm text-gray-600 mb-6">Scale Factor: 2.25</p>

          <div class="space-y-3">
            <div class="ingredient-line">
              <span>Soy Sauce</span>
              <span class="ingredient-amount">‚Öì cup ‚Üí ¬æ cup ‚úì</span>
            </div>

            <div class="ingredient-line">
              <span>Brown Sugar</span>
              <span class="ingredient-amount">2 tbsp √ó 2.25 = ?</span>
            </div>

            <div class="ingredient-line">
              <span>Sesame Oil</span>
              <span class="ingredient-amount">1 tbsp √ó 2.25 = ?</span>
            </div>

            <div class="ingredient-line">
              <span>Rice Wine</span>
              <span class="ingredient-amount">2 tsp √ó 2.25 = ?</span>
            </div>

            <div class="ingredient-line">
              <span>Ginger (grated)</span>
              <span class="ingredient-amount">1 tsp √ó 2.25 = ?</span>
            </div>

            <div class="ingredient-line">
              <span>Garlic</span>
              <span class="ingredient-amount">2 cloves √ó 2.25 = ?</span>
            </div>
          </div>
        </div>

        <div class="math-tool mt-6">
          <h3 class="font-bold text-xl mb-4 text-center">üßÆ Practice: Brown Sugar</h3>

          <div class="text-center mb-4">
            <p class="text-lg text-gray-700 mb-3">2 tablespoons √ó 2.25 = ?</p>
            <p class="text-sm text-gray-600 mb-4">(Hint: 2 √ó 2.25 = 4.5)</p>
          </div>

          <div class="calc-step">
            2 √ó 2.25 = 4.5 tablespoons
          </div>

          <div class="story-text">
            <p>"Four and a half tablespoons," Lee said. "But we don't have a half-tablespoon measure."</p>
            <p>Grandpa opened the drawer and pulled out a set of measuring spoons. "Then we use a teaspoon. How many teaspoons in a tablespoon?"</p>
            <p>"Three," Tee said.</p>
            <p>"So half a tablespoon is‚Ä¶?"</p>
            <p>"One and a half teaspoons," Lee finished.</p>
          </div>

          <div class="bg-amber-50 border-3 border-amber-300 rounded-xl p-6 mt-4 text-center">
            <p class="text-xl font-bold episode-accent">
              4.5 tablespoons = 4 tbsp + 1¬Ω tsp
            </p>
          </div>

          <p class="text-gray-700 mt-4">Grandpa measured it carefully, leveling the sugar with the back of a butter knife.</p>
        </div>

        <div id="progress-section6" class="progress-check" data-points="10"></div>
      </div>
    </section>

    <!-- SECTION 7: UNIT CONVERSION CHALLENGE -->
    <section id="section-7" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üîÑ Unit Conversion: Tablespoons ‚Üî Teaspoons
        </h2>

        <!-- PLACEHOLDER: Measurement Spoons Visual -->
        <div class="img-placeholder mb-6" style="height: 180px;">
          ü•Ñ MEASURING SPOONS PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Visual showing measuring spoons: 1 tablespoon = 3 teaspoons)</span>
        </div>

        <div class="math-tool">
          <h3 class="font-bold text-xl mb-4 text-center">üìê Conversion Reference</h3>

          <div class="conversion-table">
            <div class="conversion-row">
              <strong>3 teaspoons</strong>
              <span>=</span>
              <strong>1 tablespoon</strong>
            </div>
            <div class="conversion-row">
              <strong>1 teaspoon</strong>
              <span>=</span>
              <strong>‚Öì tablespoon</strong>
            </div>
            <div class="conversion-row">
              <strong>1.5 teaspoons</strong>
              <span>=</span>
              <strong>¬Ω tablespoon</strong>
            </div>
          </div>

          <h3 class="font-bold text-xl mb-4 text-center mt-8">üßÆ Your Turn: Convert These</h3>

          <div class="space-y-4">
            <div class="bg-gray-50 rounded p-4">
              <p class="mb-3"><strong>Sesame Oil:</strong> 1 tbsp √ó 2.25 = 2.25 tablespoons</p>
              <p class="text-sm text-gray-600 mb-2">Convert to tablespoons + teaspoons:</p>
              <div class="flex items-center gap-2">
                <input type="number" id="sesame-tbsp" class="border-2 border-amber-300 rounded px-3 py-2 w-20 text-center font-bold" placeholder="2">
                <span>tbsp +</span>
                <input type="number" step="0.25" id="sesame-tsp" class="border-2 border-amber-300 rounded px-3 py-2 w-20 text-center font-bold" placeholder="0.75">
                <span>tsp</span>
              </div>
            </div>

            <div class="bg-gray-50 rounded p-4">
              <p class="mb-3"><strong>Rice Wine:</strong> 2 tsp √ó 2.25 = 4.5 teaspoons</p>
              <p class="text-sm text-gray-600 mb-2">Convert to tablespoons + teaspoons:</p>
              <div class="flex items-center gap-2">
                <input type="number" id="wine-tbsp" class="border-2 border-amber-300 rounded px-3 py-2 w-20 text-center font-bold" placeholder="1">
                <span>tbsp +</span>
                <input type="number" step="0.5" id="wine-tsp" class="border-2 border-amber-300 rounded px-3 py-2 w-20 text-center font-bold" placeholder="1.5">
                <span>tsp</span>
              </div>
            </div>
          </div>

          <button onclick="checkConversions()" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold w-full mt-6 transition">
            Check My Conversions
          </button>

          <div id="conversion-feedback" class="mt-4"></div>
        </div>

        <div class="story-text mt-6">
          <p>Lee's notebook filled with numbers, fractions converting to decimals and back again, measurements stacking up in neat columns.</p>
          <p>Tee measured. Grandpa poured. Lee wrote it all down.</p>
        </div>

        <div id="progress-section7" class="progress-check" data-points="15"></div>
      </div>
    </section>

    <!-- SECTION 8: GINGER AND GARLIC -->
    <section id="section-8" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üßÑ The Hardest Part: Ginger & Garlic
        </h2>

        <!-- PLACEHOLDER: Grating Ginger -->
        <div class="img-placeholder mb-6" style="height: 200px;">
          üßÑ GRATING SCENE PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Tee grating ginger over bowl, Grandpa mincing garlic with knife)</span>
        </div>

        <div class="story-text">
          <p>"Ginger and garlic are the hardest," Grandpa said, picking up the ginger root. "Can't really measure these until they're chopped."</p>
          <p>He handed Tee a grater. "You do the ginger. I'll do the garlic."</p>
          <p>Tee grated the ginger over a small bowl, and the smell hit sharp and clean, almost spicy. The root turned to pale yellow pulp under the grater's teeth.</p>
          <p>"One teaspoon for the original recipe," Grandpa said. "So for nine people‚Ä¶"</p>
          <p>"Two point two five teaspoons," Lee said without looking up. She was already writing it in her notebook.</p>
          <p>Grandpa measured the grated ginger with a teaspoon, scraping it into the marinade bowl.</p>
          <p>He minced the garlic next, the knife moving fast, the pieces getting smaller and smaller until they were almost paste.</p>
          <p>"Two cloves originally," he said. "So we need‚Ä¶"</p>
          <p>"Four and a half cloves," Tee said.</p>
          <p>Grandpa raised an eyebrow. "You can't really cut a garlic clove in half before you peel it. So what do we do?"</p>
          <p>Lee thought about it. "Round up to five?"</p>
          <p>"Exactly." Grandpa smiled. "Sometimes in cooking, you make a choice. <strong class="episode-accent">Math gives you the target. Your taste tells you how close to get.</strong>"</p>
          <p>He added the garlic to the bowl.</p>
        </div>

        <div class="math-tool">
          <h3 class="font-bold text-xl mb-4 text-center">üéØ When Math Meets Reality</h3>

          <div class="bg-amber-50 border-3 border-amber-300 rounded-xl p-6">
            <p class="text-center mb-4 text-lg">
              <strong>Garlic Calculation:</strong><br>
              2 cloves √ó 2.25 = 4.5 cloves
            </p>
            <p class="text-center text-gray-700">
              But you can't use half a clove before peeling it!
            </p>
            <p class="text-center mt-4 text-xl font-bold episode-accent">
              Solution: Round to 5 cloves
            </p>
          </div>

          <div class="bg-purple-50 border-l-4 border-purple-500 p-6 rounded mt-6">
            <p class="font-bold text-lg mb-2 text-purple-800">üí° Key Lesson:</p>
            <p class="text-gray-800">
              Math gives you precision, but real-world situations sometimes require judgment. The math tells you 4.5, your experience tells you to round to 5. Both are important.
            </p>
          </div>
        </div>

        <div id="progress-section8" class="progress-check" data-points="10"></div>
      </div>
    </section>

    <!-- SECTION 9: GRANDPA'S WISDOM -->
    <section id="section-9" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          üí≠ Math Keeps People Fed
        </h2>

        <!-- PLACEHOLDER: Finished Marinade -->
        <div class="img-placeholder mb-6" style="height: 220px;">
          ü•ò MARINADE BOWL PLACEHOLDER<br>
          <span style="font-size: 0.875rem;">(Bowl of marinated beef, glossy and dark, covered with plastic wrap going into fridge)</span>
        </div>

        <div class="story-text">
          <p>Grandpa mixed everything together with a whisk‚Äîsoy sauce, sugar, sesame oil, rice wine, ginger, garlic‚Äîuntil the sugar dissolved and the marinade turned glossy and dark.</p>
          <p>Then he poured it over the beef.</p>
          <p>The meat sat in the bowl, soaking, turning darker as the marinade seeped in.</p>
          <p>"Now we wait," Grandpa said. "Thirty minutes, maybe an hour. Longer is better."</p>
          <p>He covered the bowl with plastic wrap and slid it into the fridge.</p>
          <p>Tee wiped down the counter. Lee closed her notebook, reviewing the work they had done.</p>
          <p>She had written out every step:</p>
        </div>

        <div class="recipe-card mt-6">
          <h3 class="font-bold text-lg mb-3 text-center">Lee's Notes: What We Did</h3>
          <div class="font-mono text-sm space-y-2">
            <p>‚úì The ratio: 9 √∑ 4 = 2.25</p>
            <p>‚úì Each ingredient scaled up by 2.25</p>
            <p>‚úì Converted 2.25 to 9/4 for fraction multiplication</p>
            <p>‚úì Multiplied fractions: ‚Öì √ó 9/4 = ¬æ</p>
            <p>‚úì Converted tablespoons to teaspoons</p>
            <p>‚úì Made judgment calls when needed (garlic rounding)</p>
            <p class="mt-4 pt-4 border-t-2 border-amber-300">
              <strong class="episode-accent">Final note: Precision matters.</strong>
            </p>
          </div>
        </div>

        <div class="story-text mt-6">
          <p>Grandpa washed his hands at the sink, drying them on a towel hung over his shoulder.</p>
          <p>"You two just did what I used to do in the Army," he said. "We had to calculate rations for the whole unit. If the recipe fed ten soldiers, but we had forty? We had to scale it up, fast, or people went hungry."</p>
          <p>He looked at Lee's notebook, still open on the counter.</p>
          <p>"<strong class="episode-accent">Math keeps people fed</strong>," he said. "Keeps them warm. Keeps them alive, sometimes."</p>
          <p>Lee thought about that.</p>
          <p>She thought about Tee at recess, calculating stats in his head.</p>
          <p>She thought about her essay, using evidence to prove a point.</p>
          <p>She thought about Grandpa in Korea, scaling recipes in a tent with a man named Park.</p>
          <p><strong>Everything connected.</strong></p>
          <p>Math was not just numbers on a page.</p>
          <p>It was how you made things work.</p>
        </div>

        <div class="bg-gradient-to-r from-purple-100 to-amber-100 rounded-xl p-6 mt-8">
          <h3 class="font-bold text-xl mb-4 text-center">üîó Connection to Episode 1</h3>
          <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-purple-50 border-2 border-purple-300 rounded-lg p-4">
              <p class="font-semibold mb-2 text-purple-800">Episode 1: The Recess Battle</p>
              <p class="text-sm text-gray-700">In the rap battle, Tee needed <strong>evidence</strong> to support his claims. He couldn't just say things‚Äîhe had to back them up with specific examples.</p>
            </div>
            <div class="bg-amber-50 border-2 border-amber-300 rounded-lg p-4">
              <p class="font-semibold mb-2 episode-accent">Episode 2: Grandpa's Kitchen</p>
              <p class="text-sm text-gray-700">In cooking, you need <strong>precision</strong> in your measurements. You can't just guess‚Äîyou have to calculate and convert accurately.</p>
            </div>
          </div>
          <p class="text-center mt-6 text-lg font-semibold text-gray-800">
            Same structure. Different stuff.<br>
            <span class="episode-accent">Evidence and precision both matter.</span>
          </p>
        </div>

        <div class="flex gap-3 mt-6">
          <button onclick="playStorySection('section-9')" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold transition flex items-center gap-2">
            <span>üéôÔ∏è</span>
            <span>Read Aloud</span>
          </button>
        </div>

        <div id="progress-section9" class="progress-check" data-points="15"></div>
      </div>
    </section>

    <!-- REFLECTION ACTIVITY -->
    <section id="section-10" class="mb-12">
      <div class="bg-white rounded-xl p-6 shadow-lg border-t-4 border-amber-400">
        <h2 class="font-display text-3xl font-bold mb-4 episode-accent">
          ‚úçÔ∏è Your Reflection: Precision in Your Life
        </h2>

        <div class="story-text">
          <p>"Dinner's in an hour," Grandpa said, hanging the towel back on the oven handle. "Go wash up. Tell everybody to come hungry."</p>
          <p>Tee headed toward the basement stairs.</p>
          <p>Lee lingered for a second, looking at the covered bowl in the fridge, the beef soaking in marinade, the measurements they had worked out together now turning into something real.</p>
          <p>She picked up her notebook and followed Tee downstairs.</p>
          <p>Her page was full of fractions and conversions, ratios and calculations.</p>
          <p>But what she had really learned was this:</p>
          <p><strong class="episode-accent">Precision was not just for math class.</strong></p>
          <p>It was for cooking.</p>
          <p>For arguing.</p>
          <p>For knowing when half a pound per person meant four and a half pounds total.</p>
          <p>For understanding that if you did not measure carefully, the whole thing fell apart.</p>
          <p>Grandpa was right.</p>
          <p><strong>Cooking was like debate.</strong></p>
          <p><strong class="episode-accent">You needed the right proportions.</strong></p>
        </div>

        <div class="math-tool mt-8">
          <h3 class="font-bold text-xl mb-4 text-center">üí≠ Think and Write</h3>
          <p class="text-gray-700 mb-4 text-center">Where else in your life does precision matter? Think about sports, gaming, family responsibilities, or school projects.</p>

          <textarea id="reflection-text" rows="6" class="w-full border-3 border-amber-300 rounded-lg p-4 text-lg mb-4" placeholder="Write your thoughts here... (Example: In basketball, I need to be precise with my free throw form. If I don't bend my knees at the right angle, the shot misses...)"></textarea>

          <button onclick="saveReflection()" class="bg-amber-500 hover:bg-amber-600 text-white px-8 py-4 rounded-xl font-bold text-lg w-full transition">
            Save My Reflection
          </button>

          <div id="reflection-feedback" class="mt-4"></div>
        </div>

        <div id="progress-section10" class="progress-check" data-points="15"></div>
      </div>
    </section>

    <!-- EPISODE COMPLETE -->
    <div id="episode-complete" class="hidden">
      <div class="bg-gradient-to-r from-amber-400 to-amber-600 rounded-2xl p-8 text-center text-white shadow-2xl">
        <p class="text-6xl mb-4">üéâ</p>
        <h2 class="font-display text-4xl font-bold mb-4">Episode 2 Complete!</h2>
        <p class="text-xl mb-6">You've mastered scaling recipes with fractions and decimals!</p>
        <div class="bg-white text-amber-800 rounded-xl p-6 mb-6">
          <p class="text-2xl font-bold mb-2">Total Points: <span id="final-points">0</span></p>
          <p class="text-lg mb-4">Badges Earned: <span id="final-badges">0</span></p>
          <p class="text-sm">You learned: scale factors, fraction multiplication, unit conversion, and precision!</p>
        </div>
        <a href="episode3.html" class="bg-teal-500 text-white px-8 py-4 rounded-xl font-bold text-lg inline-block hover:bg-teal-600 transition ml-4">
          Next Episode ‚Üí
        </a>
        <a href="index.html" class="bg-white text-amber-600 px-8 py-4 rounded-xl font-bold text-lg inline-block hover:bg-amber-50 transition">
          Back to Home
        </a>
      </div>
    </div>

    <!-- Skills Growth Visualizer -->
    <section class="mb-12">
      <div id="skills-visualizer"></div>
    </section>

    </div><!-- Close px wrapper -->
  </main>

  <!-- VOCABULARY MODAL -->
  <div id="vocabModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4" onclick="closeVocabModal(event)" style="display: none;">
    <div class="bg-white rounded-2xl p-8 max-w-lg w-full shadow-2xl" onclick="event.stopPropagation()">
      <div class="flex items-center justify-between mb-6">
        <h3 class="font-display text-3xl font-bold episode-accent" id="vocabWord">Word</h3>
        <button onclick="closeVocabModal(event)" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
      </div>
      <div class="mb-6">
        <p class="text-sm text-gray-500 mb-2">Definition:</p>
        <p class="text-lg text-gray-800" id="vocabDefinition">Definition here</p>
      </div>
      <div class="mb-6">
        <p class="text-sm text-gray-500 mb-2">Example:</p>
        <p class="text-lg text-gray-800 italic" id="vocabExample">Example here</p>
      </div>
      <button id="vocabSpeak" class="bg-amber-500 hover:bg-amber-600 text-white px-6 py-3 rounded-xl font-semibold w-full transition">
        üîä Hear It Pronounced
      </button>
    </div>
  </div>

  <!-- CELEBRATION OVERLAY -->
  <div id="celebrationOverlay" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" style="display: none;">
    <div class="bg-white rounded-2xl p-12 text-center max-w-md shadow-2xl">
      <div class="text-6xl mb-4" id="celebrationEmoji">üéâ</div>
      <h3 class="font-display text-3xl font-bold mb-4 episode-accent" id="celebrationTitle">Great Work!</h3>
      <p class="text-xl text-gray-700" id="celebrationMessage">You earned points!</p>
      <button onclick="closeCelebration()" class="bg-amber-500 hover:bg-amber-600 text-white px-8 py-3 rounded-xl font-semibold mt-6 transition">
        Continue Learning
      </button>
    </div>
  </div>

  <!-- Shared Components JavaScript -->
  <script src="shared/shared-components.js"></script>

  <!-- Episode 2 Specific JavaScript -->
  <script>
    // ===== LEARNING STATE MANAGEMENT =====
    // Initialize learningState if not already defined by shared-components.js
    if (typeof learningState === 'undefined') {
      var learningState = {
        points: 0,
        badges: [],
        completedActivities: []
      };
    }

    // Load progress from localStorage
    function loadProgress() {
      const saved = localStorage.getItem('episode2Progress');
      if (saved) {
        try {
          learningState = JSON.parse(saved);
        } catch (e) {
          console.error('Failed to load progress:', e);
        }
      }
      updatePointsDisplay();
    }

    // Save progress to localStorage
    function saveProgress() {
      try {
        localStorage.setItem('episode2Progress', JSON.stringify(learningState));
      } catch (e) {
        console.error('Failed to save progress:', e);
      }
    }

    // Add points and trigger celebration
    function addPoints(amount, reason) {
      learningState.points += amount;
      updatePointsDisplay();
      saveProgress();

      // Update global state if available
      if (typeof addGlobalPoints === 'function') {
        addGlobalPoints(2, amount, reason);
      }
    }

    // Update points display
    function updatePointsDisplay() {
      const pointsDisplay = document.getElementById('pointsDisplay');
      if (pointsDisplay) {
        pointsDisplay.textContent = learningState.points;
      }
    }

    // Mark section as complete
    function markProgressComplete(progressId) {
      const progressEl = document.getElementById(progressId);
      if (!progressEl) return;

      const points = parseInt(progressEl.getAttribute('data-points')) || 0;

      if (!progressEl.classList.contains('completed')) {
        progressEl.classList.add('completed');
        if (points > 0 && !learningState.completedActivities.includes(progressId)) {
          learningState.completedActivities.push(progressId);
          addPoints(points, 'Section completed!');
        }
        updateProgressBar();
        updateProgressChecklist();
      }
    }

    // Stop all narration
    function stopAllNarration() {
      if (typeof speechSynthesis !== 'undefined') {
        speechSynthesis.cancel();
      }
      const floatingBtn = document.getElementById('floatingStopBtn');
      if (floatingBtn) {
        floatingBtn.classList.remove('active');
      }
    }

    // Vocabulary modal functions
    function showVocabModal() {
      const modal = document.getElementById('vocabModal');
      if (modal) {
        modal.style.display = 'flex';
      }
    }

    function closeVocabModal(event) {
      if (event && event.target.id !== 'vocabModal') return;
      const modal = document.getElementById('vocabModal');
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Celebration overlay functions
    function showCelebration(title, message, emoji) {
      const overlay = document.getElementById('celebrationOverlay');
      if (!overlay) return;

      const titleEl = document.getElementById('celebrationTitle');
      const messageEl = document.getElementById('celebrationMessage');
      const emojiEl = document.getElementById('celebrationEmoji');

      if (titleEl) titleEl.textContent = title;
      if (messageEl) messageEl.textContent = message;
      if (emojiEl) emojiEl.textContent = emoji;

      overlay.style.display = 'flex';
    }

    function closeCelebration() {
      const overlay = document.getElementById('celebrationOverlay');
      if (overlay) {
        overlay.style.display = 'none';
      }
    }

    // Helper Modal Functions (matches Episode 1)
    function openHelper(character) {
      document.getElementById(character + '-modal').classList.add('open');
    }

    function closeHelper(e, character) {
      if (e.target.classList.contains('helper-modal')) {
        document.getElementById(character + '-modal').classList.remove('open');
      }
    }

    // Check Beef Answer
    function checkBeefAnswer() {
      const answer = parseFloat(document.getElementById('beef-answer').value);
      const feedback = document.getElementById('beef-feedback');

      if (answer === 4.5) {
        feedback.innerHTML = `
          <div class="bg-green-100 border-2 border-green-500 rounded-xl p-4">
            <p class="font-bold text-green-800 text-lg">‚úì Correct!</p>
            <p class="text-green-700">0.5 pounds √ó 9 people = 4.5 pounds. Perfect!</p>
          </div>
        `;

        if (!learningState.completedActivities.includes('beef-calc')) {
          learningState.completedActivities.push('beef-calc');
          addPoints(10, 'Beef calculation correct!');
        }

        markProgressComplete('progress-section3');
      } else {
        feedback.innerHTML = `
          <div class="bg-red-100 border-2 border-red-500 rounded-xl p-4">
            <p class="font-bold text-red-800 text-lg">‚úó Not quite</p>
            <p class="text-red-700">Try again! Remember: 0.5 √ó 9 = ?</p>
          </div>
        `;
      }
    }

    // Calculate Scale Factor
    function calculateScaleFactor() {
      document.getElementById('scale-factor-result').classList.remove('hidden');

      if (!learningState.completedActivities.includes('scale-factor')) {
        learningState.completedActivities.push('scale-factor');
        addPoints(10, 'Scale factor discovered!');
      }

      markProgressComplete('progress-section4');
    }

    // Check Unit Conversions
    function checkConversions() {
      const sesameTbsp = parseFloat(document.getElementById('sesame-tbsp').value);
      const sesameTsp = parseFloat(document.getElementById('sesame-tsp').value);
      const wineTbsp = parseFloat(document.getElementById('wine-tbsp').value);
      const wineTsp = parseFloat(document.getElementById('wine-tsp').value);

      const feedback = document.getElementById('conversion-feedback');

      const sesameCorrect = sesameTbsp === 2 && sesameTsp === 0.75;
      const wineCorrect = wineTbsp === 1 && wineTsp === 1.5;

      if (sesameCorrect && wineCorrect) {
        feedback.innerHTML = `
          <div class="bg-green-100 border-2 border-green-500 rounded-xl p-4">
            <p class="font-bold text-green-800 text-lg">‚úì Perfect Conversions!</p>
            <p class="text-green-700">Sesame Oil: 2 tbsp + ¬æ tsp (or 0.75 tsp) ‚úì</p>
            <p class="text-green-700">Rice Wine: 1 tbsp + 1.5 tsp ‚úì</p>
          </div>
        `;

        if (!learningState.completedActivities.includes('conversions')) {
          learningState.completedActivities.push('conversions');
          addPoints(15, 'Unit conversions mastered!');
        }

        markProgressComplete('progress-section7');
      } else {
        let errors = [];
        if (!sesameCorrect) errors.push('Sesame oil: 2.25 tbsp = 2 tbsp + 0.75 tsp');
        if (!wineCorrect) errors.push('Rice wine: 4.5 tsp = 1 tbsp + 1.5 tsp');

        feedback.innerHTML = `
          <div class="bg-red-100 border-2 border-red-500 rounded-xl p-4">
            <p class="font-bold text-red-800 text-lg">Check these:</p>
            ${errors.map(e => `<p class="text-red-700 text-sm">‚Ä¢ ${e}</p>`).join('')}
          </div>
        `;
      }
    }

    // Save Reflection
    function saveReflection() {
      const reflection = document.getElementById('reflection-text').value.trim();
      const feedback = document.getElementById('reflection-feedback');

      if (reflection.length < 30) {
        feedback.innerHTML = `
          <div class="bg-yellow-100 border-2 border-yellow-500 rounded-xl p-4">
            <p class="text-yellow-800">Please write at least a few sentences about where precision matters in your life.</p>
          </div>
        `;
        return;
      }

      localStorage.setItem('episode2Reflection', reflection);

      feedback.innerHTML = `
        <div class="bg-green-100 border-2 border-green-500 rounded-xl p-4">
          <p class="font-bold text-green-800 text-lg">‚úì Reflection Saved!</p>
          <p class="text-green-700">Great thinking about precision in your own life!</p>
        </div>
      `;

      if (!learningState.completedActivities.includes('reflection')) {
        learningState.completedActivities.push('reflection');
        addPoints(15, 'Thoughtful reflection!');
      }

      markProgressComplete('progress-section10');
    }

    // NOTE: markProgressComplete is defined earlier (lines 1218-1232) - removed duplicate here
    // NOTE: updateProgressBar is defined below (lines 1690+) with null guards - removed duplicate here

    // Simplified Text-to-Speech
    function playStorySection(sectionId) {
      const section = document.getElementById(sectionId);
      if (!section) return;

      stopAllNarration();

      const storyText = section.querySelector('.story-text');
      if (!storyText) return;

      const text = storyText.textContent;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.rate = 0.9;
      utterance.pitch = 1;

      utterance.onend = function() {
        stopAllNarration();
        const progressId = 'progress-' + sectionId.replace('-', '');
        markProgressComplete(progressId);
      };

      speechSynthesis.speak(utterance);

      const floatingBtn = document.getElementById('floatingStopBtn');
      if (floatingBtn) floatingBtn.classList.add('active');
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', function() {
      loadProgress();
      updateProgressBar();

      // Load saved reflection if exists
      const savedReflection = localStorage.getItem('episode2Reflection');
      if (savedReflection) {
        document.getElementById('reflection-text').value = savedReflection;
      }

      // Initialize skills visualizer
      if (typeof renderSkillsVisualizer === 'function') {
        renderSkillsVisualizer(2);
      }

      // Initialize progress checklist
      updateProgressChecklist();
    });

    // ===== GLOBAL STATE INTEGRATION =====

    function toggleLeftRail() {
      const rail = document.getElementById('left-rail');
      if (rail) {
        rail.classList.toggle('mobile-hidden');
        rail.classList.toggle('mobile-open');
      }
    }

    function resetEpisodeProgress() {
      if (confirm('Reset all progress for this episode?')) {
        localStorage.removeItem('episode2Progress');
        localStorage.removeItem('episode2SkillState');
        location.reload();
      }
    }

    // NOTE: updateProgressChecklist is defined below (with all 10 items) - removed duplicate here

    // ===== PROGRESSIVE NAVIGATION INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        console.log('üöÄ Initializing Episode 2 with Progressive Navigation');

        // 0. Load saved progress
        loadProgress();
        updateProgressBar();
        updateProgressChecklist();

        // 1. Create progressive navigation instance
        const progressiveNav = new ProgressiveNav(2, 7);

        // 2. Register sections
        progressiveNav.registerSection(1, 'Start: The Story', 'üìñ', false);
        progressiveNav.registerSection(2, 'Vocabulary: Key Concepts', 'üìö', false);
        progressiveNav.registerSection(3, 'Story: The Math', 'üî¢', false);
        progressiveNav.registerSection(4, 'Strategy: Practice', 'üéØ', false);
        progressiveNav.registerSection(5, 'Model: Grandpa\'s Wisdom', 'üí≠', false);
        progressiveNav.registerSection(6, 'Your Turn: Reflect', '‚úçÔ∏è', false);
        progressiveNav.registerSection(7, 'Celebrate: Complete', 'üéâ', false);

        // 3. Wrap existing content sections
        wrapSectionsForProgressiveNav();

        // 4. Initialize the navigation
        progressiveNav.init();

        // 5. Force Section 1 to show
        setTimeout(() => {
          progressiveNav.currentSection = 1;
          progressiveNav.showSection(1);
          console.log('‚úì Episode 2 Section 1 displayed');
        }, 100);

        // 6. Load translation languages (matching Episode 1)
        if (typeof translator !== 'undefined') {
          await translator.loadLanguage('en');
          await translator.loadLanguage('es');
          await translator.loadLanguage('fr');
          await translator.loadLanguage('ht');
          addTranslationUI();
          translator.translatePage();
          // Add story language rendering (matches Episode 1)
          if (typeof translator.renderStoryLanguage === 'function') {
            translator.renderStoryLanguage(translator.currentLang);
          }
        }

        // 7. Initialize adaptive helpers if available
        if (typeof adaptiveHelpers !== 'undefined') {
          adaptiveHelpers.init();
        }

        // 8. Sync unified dashboard shell (matches Episode 1)
        if (window.LearningShell && typeof window.LearningShell.refresh === 'function') {
          window.LearningShell.refresh();
        }

        console.log('‚úÖ Episode 2 Progressive Navigation initialized');

      } catch (error) {
        console.error('‚ùå Failed to initialize Episode 2 navigation:', error);
        // Graceful degradation - show all content
        document.querySelectorAll('section[id^="section-"]').forEach(section => {
          section.style.display = 'block';
        });
      }
    });

    /**
     * Wrap Episode 2 sections into progressive nav containers
     */
    function wrapSectionsForProgressiveNav() {
      const sectionDisplay = document.getElementById('section-display');
      if (!sectionDisplay) {
        console.error('section-display container not found');
        return;
      }

      // Section 1: The Smell + Recipe Card (sections 1-2)
      const sec1 = document.getElementById('section-1');
      const sec2 = document.getElementById('section-2');
      if (sec1 && sec2) {
        const wrapper1 = document.createElement('div');
        wrapper1.className = 'section-content';
        wrapper1.setAttribute('data-section', '1');
        sectionDisplay.appendChild(wrapper1);
        wrapper1.appendChild(sec1);
        wrapper1.appendChild(sec2);
      }

      // Section 2: Calculating + Scale Factor (sections 3-4)
      const sec3 = document.getElementById('section-3');
      const sec4 = document.getElementById('section-4');
      if (sec3 && sec4) {
        const wrapper2 = document.createElement('div');
        wrapper2.className = 'section-content';
        wrapper2.setAttribute('data-section', '2');
        sectionDisplay.appendChild(wrapper2);
        wrapper2.appendChild(sec3);
        wrapper2.appendChild(sec4);
      }

      // Section 3: Multiplying Fractions + Scaling (sections 5-6)
      const sec5 = document.getElementById('section-5');
      const sec6 = document.getElementById('section-6');
      if (sec5 && sec6) {
        const wrapper3 = document.createElement('div');
        wrapper3.className = 'section-content';
        wrapper3.setAttribute('data-section', '3');
        sectionDisplay.appendChild(wrapper3);
        wrapper3.appendChild(sec5);
        wrapper3.appendChild(sec6);
      }

      // Section 4: Unit Conversion + Ginger & Garlic (sections 7-8)
      const sec7 = document.getElementById('section-7');
      const sec8 = document.getElementById('section-8');
      if (sec7 && sec8) {
        const wrapper4 = document.createElement('div');
        wrapper4.className = 'section-content';
        wrapper4.setAttribute('data-section', '4');
        sectionDisplay.appendChild(wrapper4);
        wrapper4.appendChild(sec7);
        wrapper4.appendChild(sec8);
      }

      // Section 5: Grandpa's Wisdom (section 9)
      const sec9 = document.getElementById('section-9');
      if (sec9) {
        const wrapper5 = document.createElement('div');
        wrapper5.className = 'section-content';
        wrapper5.setAttribute('data-section', '5');
        sectionDisplay.appendChild(wrapper5);
        wrapper5.appendChild(sec9);
      }

      // Section 6: Reflection Activity (section 10)
      const sec10 = document.getElementById('section-10');
      if (sec10) {
        const wrapper6 = document.createElement('div');
        wrapper6.className = 'section-content';
        wrapper6.setAttribute('data-section', '6');
        sectionDisplay.appendChild(wrapper6);
        wrapper6.appendChild(sec10);
      }

      // Section 7: Episode Complete
      const episodeComplete = document.getElementById('episode-complete');
      if (episodeComplete) {
        const wrapper7 = document.createElement('div');
        wrapper7.className = 'section-content';
        wrapper7.setAttribute('data-section', '7');
        sectionDisplay.appendChild(wrapper7);
        wrapper7.appendChild(episodeComplete);
      }

      console.log('‚úì Episode 2 sections wrapped for progressive navigation');
    }

    /**
     * Add translation UI (simple fallback if not provided by shared header)
     */
    function addTranslationUI() {
      // Translation UI will be added by shared-header.js
      // This is just a placeholder function for compatibility
      console.log('Translation UI loaded');
    }

    // ===== ACCESSIBILITY FUNCTIONS =====
    function toggleDyslexia() {
      document.body.classList.toggle('dyslexia-mode');
    }

    function toggleHighContrast() {
      document.body.classList.toggle('high-contrast');
    }

    // ===== NULL GUARDS FOR OPTIONAL UI ELEMENTS =====
    function updateProgressBar() {
      // Use progress-fill (the actual element ID in HTML) not progressBar
      const progressFill = document.getElementById('progress-fill');
      if (progressFill) {
        const totalSections = 10;
        const completedSections = document.querySelectorAll('.progress-check.completed').length;
        const percentage = (completedSections / totalSections) * 100;
        progressFill.style.width = percentage + '%';

        // Check if episode complete
        if (percentage >= 100) {
          setTimeout(() => {
            const episodeCompleteEl = document.getElementById('episode-complete');
            if (episodeCompleteEl) {
              episodeCompleteEl.classList.remove('hidden');
              const finalPoints = document.getElementById('final-points');
              const finalBadges = document.getElementById('final-badges');
              if (finalPoints) finalPoints.textContent = learningState.points;
              if (finalBadges) finalBadges.textContent = learningState.badges.length;
            }
          }, 1000);
        }
      }
    }

    function updateProgressChecklist() {
      const checklist = document.getElementById('progress-checklist');
      if (!checklist) return;

      const items = [
        { id: 'progress-section1', label: 'The Smell' },
        { id: 'progress-section2', label: 'Recipe Card' },
        { id: 'progress-section3', label: 'Beef Calculation' },
        { id: 'progress-section4', label: 'Scale Factor' },
        { id: 'progress-section5', label: 'Fractions' },
        { id: 'progress-section6', label: 'Scaling' },
        { id: 'progress-section7', label: 'Conversions' },
        { id: 'progress-section8', label: 'Ginger & Garlic' },
        { id: 'progress-section9', label: 'Wisdom' },
        { id: 'progress-section10', label: 'Reflection' }
      ];

      checklist.innerHTML = items.map(item => {
        const el = document.getElementById(item.id);
        const complete = el && el.classList.contains('completed');
        return `
          <div class="flex items-center gap-2 px-3 py-2 rounded-lg ${complete ? 'bg-green-50' : 'bg-gray-50'}">
            <span class="text-lg">${complete ? '‚úÖ' : '‚¨ú'}</span>
            <span class="text-gray-700 ${complete ? 'font-semibold' : ''}">${item.label}</span>
          </div>
        `;
      }).join('');
    }
  </script>

</body>
</html>
